<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Profiles â€” Isaline (Glass Door)</title>
<style>
  /* micro animations for fav & play states */
  #favBtn { transition: transform 200ms ease, box-shadow 200ms ease, color 260ms ease; }
  #playBtn { transition: transform 160ms ease; }
  #playBtn:active { transform: scale(.98); }

@font-face {
  font-family: 'SwirlyCanalope';
  src: url('SwirlyCanalopePERSONALUSE-Regular.woff2') format('woff2'),
       url('SwirlyCanalopePERSONALUSE-Regular.woff') format('woff');
  font-display: swap;
}

/* ---------- variables & base ---------- */
:root{
  --bg-0:#07060a;
  --bg-1:#14121a;
  --card:#171821;
  --glass: rgba(255,255,255,0.06);
  --glass-2: rgba(255,255,255,0.09);
  --accent:#f7d6ff;
  --text:#f5f3ff;
  --soft:#b8b5d0;

  --max-width:480px;
  --page-padding: clamp(12px, 3.5vw, 20px);
  --card-radius: 16px;
  --tab-gap: 8px;
  --tab-min-width: 110px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;}
body{
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(1200px 800px at 10% 10%, #1c1530 0%, #07060a 45%, #03020a 100%);
  color:var(--text);min-height:100vh;overflow:hidden;padding:20px;
}

/* container for app */
.shell{width:100%;max-width:var(--max-width);position:relative;z-index:10}

/* CONTENT (behind the glass door) */
.card{
  border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.03); box-shadow:0 18px 40px rgba(0,0,0,0.6);
  transform:translateY(0); transition:opacity .45s ease .35s, transform .45s ease .35s;
  opacity:0; pointer-events:auto;
  backdrop-filter: blur(2px);
  position:relative;
}
.content-visible .card{ opacity:1; transform:none; }

/* ======= COMPACT HEADER (replaces old header) ======= */
.title-row.compact{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:10px; /* compact */
  padding-right:2px;
}
.title-left { display:flex; align-items:center; gap:12px; }
.compact-title{
  margin:0;
  font-size:16px;
  font-weight:700;
  letter-spacing: -0.01em;
}
/* subtitle removed to free space */
.subtitle { display:none !important; }

/* ---------- TABS + NEWS ROW (new) ---------- */
/* wrap tabs + news button in a single row so news button stays aligned */
.tabs-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom: 10px;
}

/* tabs */
.tabs{
  display:flex;
  gap:var(--tab-gap);
  align-items:center;
  flex:1;                /* let tabs take remaining space */
}
.tab{
  min-width:var(--tab-min-width);
  flex:1;
  padding:8px 10px;
  border-radius:999px;
  font-size:13px;
  background:transparent;
  color:var(--soft);
  border:1px solid transparent;
  cursor:pointer;
  text-align:center;
  white-space:nowrap;
}
.tab.active{
  background:linear-gradient(180deg, rgba(247,214,255,0.06), rgba(247,214,255,0.03));
  border-color:rgba(247,214,255,0.12);
  color:var(--text);
}

/* NEWS button (rounded icon in the top-right of the card, aligned with tabs) */
.news-btn{
  flex:0 0 auto;
  width:38px;
  height:38px;
  border-radius:999px;
  display:inline-grid;
  place-items:center;
  background: linear-gradient(180deg, rgba(245,240,255,0.06), rgba(240,215,255,0.03));
  border:1px solid rgba(255,255,255,0.04);
  cursor:pointer;
  position:relative;
  transition: transform 140ms ease, box-shadow 160ms ease;
}
.news-btn:hover{ transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }

/* small news icon (use an emoji, svg, or image) */
.news-btn .icon { font-size:16px; line-height:1; color:var(--soft) }

/* little badge for "new" â€” adjustable via JS (show/hide) */
.news-btn .badge {
  position:absolute;
  top:6px;
  right:6px;
  width:8px;
  height:8px;
  border-radius:50%;
  background:#ff6b8a;
  box-shadow: 0 2px 8px rgba(255,80,120,0.18);
  display:none; /* set to block via JS to show */
}

/* small tooltip text (visually hidden, for a11y) */
.news-btn[title]:after {
  content: attr(title);
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: #fff;
  font-size:11px;
  padding:6px 8px;
  border-radius:8px;
  white-space:nowrap;
  display:none;
}
.news-btn:focus[title]:after, .news-btn:hover[title]:after { display:block; }

/* small-screen tweaks */
@media (max-width:480px){
  .leaf::after{left:12%;right:12%}
  :root{ --tab-min-width:92px; }
  .news-btn{ width:36px; height:36px; }
}

/* ---------- other styles (unchanged) ---------- */
.profile{
  border-radius:14px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(9,9,18,0.95));
  border:1px solid rgba(255,255,255,0.02);margin-bottom:14px;
  position:relative;
  overflow:hidden;
}
.profile h2{margin:0 0 2px;font-size:15px;font-weight:600}
.profile small{display:block;font-size:11px;color:var(--soft);margin-bottom:8px}
.profile p {
  font-family: 'SwirlyCanalope', serif;
  font-size: 18px;
  color: #eedeff;
  line-height: 1.6;
  margin:0;
}

/* buttons */
.btn-row{display:flex;gap:8px}
button.primary, button.ghost{flex:1;border-radius:999px;padding:10px 16px;font-size:13px;font-weight:600;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
button.primary{background:#f5f0ff;color:#161622}
button.ghost{background:transparent;color:var(--soft);border:1px solid rgba(255,255,255,0.06)}

/* fav/play defaults */
/* <-- adjusted spacing as requested -->
   fav button padding-left: 8px; label margin-left: 2px (close to the gif)
*/
#favBtn { padding-left: 8px; padding-right: 16px; background:#f5f0ff; color:#161622; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
#favBtn .label-text { margin-left:2px; display:inline-block; vertical-align:middle; }
#playBtn { background:#f5f0ff; color:#161622; box-shadow:0 6px 18px rgba(0,0,0,0.06); padding-left: 18px; padding-right: 18px; }

#favIcon{ width:18px; height:18px; object-fit:contain; border-radius:6px; display:inline-block; vertical-align:middle; }

/* focus outlines */
.tab:focus, .news-btn:focus { outline: 3px solid rgba(247,214,255,0.12); outline-offset:3px; }

</style>
</head>
<body>
  <!-- door overlay -->
  <div class="door-overlay" id="doorOverlay" aria-hidden="true">
    <div class="door-wrap" id="doorWrap">
      <div class="leaf left"><div class="label">â€” S15 â€”</div></div>
      <div class="leaf right"><div class="label">â€” atelier â€”</div></div>
    </div>
  </div>

  <!-- main content -->
  <div class="shell" id="shell">
    <div class="card" id="card">

      <!-- header -->
      <div class="title-row compact simple-one" role="banner">
        <h1 class="compact-title simple-name">Auroreine</h1>
      </div>

      <!-- tabs + news -->
      <div class="tabs-row">
        <div class="tabs" id="tabs">
          <button class="tab active" id="tab-zhou">âœ¦ Muse</button>
          <button class="tab" id="tab-rp">âœ§ Another Universe</button>
        </div>

        <!-- rounded news icon at the right, badge toggled by JS -->
        <button class="news-btn" id="newsBtn" title="Update terbaru">
          <span class="icon">ðŸ“°</span>
          <span class="badge" id="newsBadge" aria-hidden="true"></span>
        </button>
      </div>

      <div class="profile" id="profile">
        <h2 id="profile-title">Zhou Xinyu</h2>
        <small id="profile-tag">Muse Â· TripleS</small>
        <p id="profile-text">Soft-spoken, stage-light kind of pretty.
Carries winter glow and slow-day calm,
like a quiet verse written in silver.</p>
      </div>

      <div class="btn-row">
        <button class="primary" id="favBtn" aria-pressed="false" title="Favorite">
          <img id="favIcon" alt="fox icon" src="foxfixfix.gif" aria-hidden="true">
          <span class="label-text">Favorite</span>
        </button>
        <button class="ghost" id="playBtn" aria-pressed="false" title="Play preview">â–¶ Play</button>
      </div>

      <audio id="profileAudio" preload="auto">
        <source src="playsongnew.mp3" type="audio/mpeg">
      </audio>

      <div class="helper">Your choice will be sent back to the bot as a tiny note.</div>
    </div>
  </div>

  <audio id="doorAudio" preload="auto">
    <source src="door_open.mp3" type="audio/mpeg">
  </audio>

  <button class="replay" id="replayBtn" title="Replay door effect">Replay âœ¨</button>

<script>
  // TELEGRAM WebApp (if available)
  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  if (tg) try { tg.expand(); tg.ready(); } catch(e){}

  // DOM refs
  const tZ = document.getElementById('tab-zhou');
  const tR = document.getElementById('tab-rp');
  const tabsRoot = document.getElementById('tabs');
  const newsBtn = document.getElementById('newsBtn');
  const newsBadge = document.getElementById('newsBadge');

  // === NEWS URL set to your channel ===
  const NEWS_URL = 'https://t.me/S15XINYU';
  // show badge by default (toggle below if you want it hidden)
  const HAS_NEW_UPDATE = true;
  function refreshNewsBadge() {
    if (!newsBadge) return;
    newsBadge.style.display = HAS_NEW_UPDATE ? 'block' : 'none';
  }
  refreshNewsBadge();

  // News click: open inside Telegram WebApp when possible, fallback to window.open
  newsBtn.addEventListener('click', ()=> {
    if (!NEWS_URL || NEWS_URL.trim() === '') {
      alert('Belum ada URL berita/updates di-set. Edit NEWS_URL di kode.');
      return;
    }
    try {
      if (tg && typeof tg.openLink === 'function') {
        tg.openLink(NEWS_URL);
      } else if (tg && tg.openTelegram) {
        tg.openTelegram(NEWS_URL);
      } else {
        window.open(NEWS_URL, '_blank', 'noopener');
      }
      // optionally hide the badge after opening:
      // newsBadge.style.display = 'none';
    } catch (e) {
      window.open(NEWS_URL, '_blank', 'noopener');
    }
  });

  /* ---------- rest of JS (fav, audio, tabs, sparkles) ---------- */
  const doorOverlay = document.getElementById('doorOverlay');
  const doorWrap = document.getElementById('doorWrap');
  const shell = document.getElementById('shell');
  const card = document.getElementById('card');
  const doorAudio = document.getElementById('doorAudio');
  const replayBtn = document.getElementById('replayBtn');

  const profiles = {
    zhou: {
      title: "Zhou Xinyu",
      tag: "Muse Â· TripleS",
      text: "Soft-spoken, stage-light kind of pretty.\nCarries winter glow and slow-day calm,\nlike a quiet verse written in silver."
    },
    rp: {
      title: "Meredith Melrose",
      tag: "S15 Â· night-coded",
      text: "Writes in lowercase and starlight.\nHalf diary, half song, always a little\nlate to leave the dream."
    }
  };
  let selected = 'zhou';

  function setActive(k){
    selected = k;
    const d = profiles[k];
    document.getElementById('profile-title').textContent = d.title;
    document.getElementById('profile-tag').textContent = d.tag;
    document.getElementById('profile-text').textContent = d.text;
    if(k==='zhou'){ tZ.classList.add('active'); tR.classList.remove('active'); } else { tR.classList.add('active'); tZ.classList.remove('active'); }
  }

  // sparkles
  function makeSparkle(x, y, size = null) {
    const profileBox = document.getElementById("profile");
    if (!profileBox) return;
    const sp = document.createElement("div");
    sp.className = "sparkle-pop";
    const s = size || (6 + Math.floor(Math.random()*8));
    sp.style.width = s + "px";
    sp.style.height = s + "px";
    sp.style.left = Math.round(x) + "px";
    sp.style.top = Math.round(y) + "px";
    sp.style.transform = `translateY(0) scale(${0.6 + Math.random()*0.9})`;
    profileBox.appendChild(sp);
    setTimeout(() => { if (sp && sp.parentNode) sp.parentNode.removeChild(sp); }, 1400);
  }
  function burstSparkles(count = 5) {
    const box = document.getElementById("profile");
    if (!box) return;
    const rect = box.getBoundingClientRect();
    for (let i = 0; i < count; i++) {
      const delay = Math.random() * 180;
      setTimeout(() => {
        const paddingX = Math.max(8, rect.width * 0.06);
        const paddingY = Math.max(8, rect.height * 0.06);
        const x = Math.random() * (rect.width - paddingX*2) + paddingX;
        const y = Math.random() * (rect.height - paddingY*2) + paddingY;
        makeSparkle(x, y);
      }, delay);
    }
  }

  tZ.addEventListener('click', ()=> { setActive('zhou'); burstSparkles(6); });
  tR.addEventListener('click', ()=> { setActive('rp'); burstSparkles(6); });

  // fav + audio
  const favBtn = document.getElementById('favBtn');
  const playBtn = document.getElementById('playBtn');
  const profileAudio = document.getElementById('profileAudio') || null;
  const favIcon = document.getElementById('favIcon');

  const PROFILE_AUDIO_MAP = { zhou: 'playsongnew.mp3', rp: 'playsongnew.mp3' };
  function currentProfileAudioFile() { return PROFILE_AUDIO_MAP[selected] || 'playsongnew.mp3'; }

  const STORAGE_KEY = 'miniapp_favs_v1';
  function loadFavs(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : {}; }catch(e){return{}} }
  function saveFavs(obj){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }catch(e){} }

  const FOX_GIF = 'foxfixfix.gif';
  favIcon.addEventListener('error', ()=>{ favIcon.style.display='none'; const label = favBtn.querySelector('.label-text'); if(label) label.style.marginLeft='0'; });
  favIcon.addEventListener('load', ()=>{ favIcon.style.display='inline-block'; });

  function setFavState(isFav){
    favBtn.setAttribute('aria-pressed', isFav ? 'true' : 'false');
    const label = favBtn.querySelector('.label-text');
    if(label) label.textContent = isFav ? 'Favorited' : 'Favorite';
    try { favIcon.src = FOX_GIF; } catch(e){}
    if(isFav){ favIcon.classList.add('fav-gif-in'); favBtn.classList.add('fav-active'); try{ burstSparkles(5); }catch(e){} }
    else { favIcon.classList.remove('fav-gif-in'); favBtn.classList.remove('fav-active'); }
  }

  favBtn.addEventListener('click', () => {
    const favs = loadFavs();
    const currently = !!favs[selected];
    if(currently) delete favs[selected]; else favs[selected] = { ts: Date.now() };
    saveFavs(favs);
    setFavState(!currently);
    if (tg && tg.sendData) try { tg.sendData(JSON.stringify({ type:'fav', profile:selected, fav:!currently })); } catch(e){}
  });

  function initFavUIForCurrent(){ const favs = loadFavs(); const isFav = !!favs[selected]; favIcon.src = FOX_GIF; setFavState(isFav); }

  // play/pause logic
  playBtn.addEventListener('click', async ()=> {
    if (!profileAudio) { alert('Audio not available. Tambahkan playsongnew.mp3 di folder yang sama.'); return; }
    const desired = currentProfileAudioFile();
    const currentSource = profileAudio.querySelector('source')?.getAttribute('src') || '';
    if (currentSource !== desired) { profileAudio.innerHTML = `<source src="${desired}" type="audio/mpeg">`; try{ profileAudio.load(); }catch(e){} }
    try{
      if (profileAudio.paused) { await profileAudio.play(); playBtn.classList.add('playing'); playBtn.textContent='â¸ Pause'; playBtn.setAttribute('aria-pressed','true'); }
      else { profileAudio.pause(); playBtn.classList.remove('playing'); playBtn.textContent='â–¶ Play'; playBtn.setAttribute('aria-pressed','false'); }
    } catch(err){ playBtn.classList.remove('playing'); playBtn.textContent='â–¶ Play'; playBtn.setAttribute('aria-pressed','false'); alert('Gagal memutar audio â€” periksa file playsongnew.mp3'); }
  });

  if(profileAudio){
    profileAudio.addEventListener('play', ()=>{ playBtn.classList.add('playing'); playBtn.textContent='â¸ Pause'; playBtn.setAttribute('aria-pressed','true'); });
    profileAudio.addEventListener('pause', ()=>{ playBtn.classList.remove('playing'); playBtn.textContent='â–¶ Play'; playBtn.setAttribute('aria-pressed','false'); });
    profileAudio.addEventListener('ended', ()=>{ playBtn.classList.remove('playing'); playBtn.textContent='â–¶ Play'; playBtn.setAttribute('aria-pressed','false'); try{ profileAudio.currentTime=0;}catch(e){} });
  }

  // init
  window.addEventListener('load', ()=> { initFavUIForCurrent(); });

  // door animation
  function openDoor(playSound=true){
    setTimeout(()=> shell.classList.add('content-visible'), 1200);
    if(playSound && doorAudio && doorAudio.src){ doorAudio.currentTime=0; doorAudio.play().catch(()=>{}); }
    doorWrap.classList.add('door-opening');
    setTimeout(()=> { doorOverlay.classList.add('hidden-overlay'); shell.classList.add('content-visible'); }, 1600);
  }
  setTimeout(()=> openDoor(true), 260);
  replayBtn.addEventListener('click', ()=> { doorOverlay.classList.remove('hidden-overlay'); doorWrap.classList.remove('door-opening'); shell.classList.remove('content-visible'); void doorWrap.offsetWidth; setTimeout(()=> openDoor(true), 80); });

  // responsive helper
  (function(){
    function updateTabsMode() {
      if(!tabsRoot) return;
      if(window.matchMedia('(max-width: 639px)').matches) tabsRoot.classList.add('tabs-scroll'); else tabsRoot.classList.remove('tabs-scroll');
    }
    updateTabsMode();
    window.addEventListener('resize', updateTabsMode);
    window.addEventListener('orientationchange', updateTabsMode);
  })();

</script>
</body>
</html>
