<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Profiles — Isaline (Glass Door)</title>
<style>
  
  /* heart favorite micro animation */
#favBtn.fav-active {
  transform: scale(1.06);
  transition: transform 220ms cubic-bezier(.2,.9,.2,1);
  box-shadow: 0 6px 18px rgba(180,120,255,0.10);
}
#favBtn { transition: transform 200ms ease, box-shadow 200ms ease; }

/* play button subtle focus */
#playBtn { transition: transform 160ms ease; }
#playBtn:active { transform: scale(.98); }
  
@font-face {
  font-family: 'SwirlyCanalope';
  src: url('SwirlyCanalopePERSONALUSE-Regular.woff2') format('woff2'),
       url('SwirlyCanalopePERSONALUSE-Regular.woff') format('woff');
  font-display: swap;
}

/* ---------- variables & base ---------- */
:root{
  --bg-0:#07060a;
  --bg-1:#14121a;
  --card:#171821;
  --glass: rgba(255,255,255,0.06);
  --glass-2: rgba(255,255,255,0.09);
  --accent:#f7d6ff;
  --text:#f5f3ff;
  --soft:#b8b5d0;

  --max-width:480px;
  --page-padding: clamp(12px, 3.5vw, 20px);
  --card-radius: 16px;
  --tab-gap: 8px;
  --tab-min-width: 110px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;}
body{
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(1200px 800px at 10% 10%, #1c1530 0%, #07060a 45%, #03020a 100%);
  color:var(--text);min-height:100vh;overflow:hidden;padding:20px;
}

/* container for app */
.shell{width:100%;max-width:var(--max-width);position:relative;z-index:10}

/* CONTENT (behind the glass door) */
.card{
  border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.03); box-shadow:0 18px 40px rgba(0,0,0,0.6);
  transform:translateY(0); transition:opacity .45s ease .35s, transform .45s ease .35s;
  opacity:0; pointer-events:auto;
  backdrop-filter: blur(2px);
}
.content-visible .card{ opacity:1; transform:none; }

.title-row{display:flex;align-items:center;justify-content:space-between;gap:10px}
.pill{font-size:11px;padding:4px 10px;border-radius:999px;color:var(--accent);border:1px solid rgba(247,214,255,0.18)}
h1{margin:8px 0 2px;font-size:18px;font-weight:600}
.subtitle{margin:0 0 14px;font-size:12px;color:var(--soft)}

/* ---------- TABS (responsive) ---------- */
.tabs{
  display:flex;
  gap:var(--tab-gap);
  margin-bottom:10px;
  align-items:center;
  /* default: allow shrink on wide screens */
}
.tab{
  min-width:var(--tab-min-width);
  flex:1;
  padding:8px 10px;
  border-radius:999px;
  font-size:13px;
  background:transparent;
  color:var(--soft);
  border:1px solid transparent;
  cursor:pointer;
  text-align:center;
  white-space:nowrap;
}
.tab.active{
  background:linear-gradient(180deg, rgba(247,214,255,0.06), rgba(247,214,255,0.03));
  border-color:rgba(247,214,255,0.12);
  color:var(--text);
}

/* small-screen: horizontal scroll with snap */
.tabs.tabs-scroll{
  overflow-x:auto;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  padding-bottom:6px;
}
.tabs.tabs-scroll .tab{
  scroll-snap-align: start;
  flex:0 0 auto;
}

/* large screen: distribute evenly using grid */
@media (min-width:640px){
  .tabs{
    display:grid;
    grid-auto-flow:column;
    grid-auto-columns:1fr;
    gap:10px;
  }
  .tabs .tab{
    min-width:0;
    flex:1 1 auto;
  }
  .card{ padding:22px; }
}

/* card/profile styles */
.profile{
  border-radius:14px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(9,9,18,0.95));
  border:1px solid rgba(255,255,255,0.02);margin-bottom:14px;
  position:relative;      /* for sparkle absolute children */
  overflow:hidden;        /* keep sparkles inside */
}
.profile h2{margin:0 0 2px;font-size:15px;font-weight:600}
.profile small{display:block;font-size:11px;color:var(--soft);margin-bottom:8px}
.profile p {
  font-family: 'SwirlyCanalope', serif;
  font-size: 18px;
  color: #eedeff;
  line-height: 1.6;
  margin:0;
}

/* ---------- SPARKLE (interactive) ---------- */
.sparkle-pop {
  position: absolute;
  width: 6px;
  height: 6px;
  pointer-events: none;
  border-radius: 50%;
  background: radial-gradient(circle, #ffffff 0%, #e7d4ff 60%, transparent 100%);
  opacity: 0;
  animation: sparkleFade 1.2s ease-out forwards;
  filter: blur(0.4px);
  transform-origin: center;
}
@keyframes sparkleFade {
  0% { transform: translateY(0) scale(0.5); opacity: 0; }
  15% { transform: translateY(-4px) scale(1); opacity: 0.95; }
  50% { transform: translateY(-12px) scale(1.15); opacity: 0.8; }
  100% { transform: translateY(-22px) scale(0.7); opacity: 0; }
}

/* buttons */
.btn-row{display:flex;gap:8px}
button.primary, button.ghost{flex:1;border-radius:999px;padding:10px 12px;font-size:13px;font-weight:600;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px}
button.primary{background:#f5f0ff;color:#161622}
button.ghost{background:transparent;color:var(--soft);border:1px solid rgba(255,255,255,0.06)}
/* make both fav & play look identical initially (override ghost) */
#favBtn, #playBtn {
  /* use the primary button look initially */
  background: #f5f0ff;
  color: #161622;
  border: none;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
}

/* keep hover/focus micro feedback */
#favBtn:hover, #playBtn:hover { transform: translateY(-2px); transition: transform 120ms ease; }

/* favorite active (already used) — also update background for clearer feedback */
#favBtn.fav-active {
  background: linear-gradient(180deg, #fceeff, #f7d6ff);
  color: #161622;
  box-shadow: 0 10px 26px rgba(180,120,255,0.14);
}

/* playing state for play button */
#playBtn.playing {
  background: linear-gradient(180deg, #fff2fb, #f4caff);
  color: #161622;
  box-shadow: 0 10px 26px rgba(160,110,240,0.12);
}

/* subtle pressed state */
#favBtn:active, #playBtn:active { transform: scale(0.99); transition: transform 80ms ease; }

.helper{margin-top:10px;font-size:10px;color:#8581a1;text-align:center}

/* GLASS DOOR overlay */
.door-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999;pointer-events:auto}
.door-wrap{width:100%;max-width:900px;height:100vh;display:flex;perspective:1400px}
.leaf{
  flex:1;height:100vh;display:flex;align-items:center;justify-content:center;
  position:relative;overflow:hidden;
  border:1px solid rgba(255,255,255,0.06);

  /* kaca ungu lembut */
  background:
    linear-gradient(180deg, rgba(180,140,255,0.10), rgba(120,90,180,0.12)),
    linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));

  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.08),
    0 30px 80px rgba(60,0,120,0.45);

  transform-origin:left center;transform-style:preserve-3d;
  backdrop-filter: blur(7px) saturate(1.15);
}
.leaf.right{transform-origin:right center}
.leaf::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg,
    rgba(200,160,255,0.05),
    rgba(240,200,255,0.12) 20%,
    rgba(150,120,220,0.06) 55%,
    transparent 85%
  );
  mix-blend-mode:screen;
  pointer-events:none;
  transform:translateZ(40px);
}
.leaf::after{
  content:"";position:absolute;left:18%;right:18%;top:40%;height:2px;border-radius:50px;
  background:linear-gradient(90deg, rgba(160,120,255,0.18), rgba(245,215,255,0.22));
  opacity:1;
}
.leaf .label{position:relative;color:var(--soft);font-size:14px;letter-spacing:0.04em}

/* open animations */
@keyframes open-left {
  0%{ transform: rotateY(0deg) translateZ(0) }
  100%{ transform: rotateY(-88deg) translateZ(-60px) translateX(-20%); opacity:0 }
}
@keyframes open-right {
  0%{ transform: rotateY(0deg) translateZ(0) }
  100%{ transform: rotateY(88deg) translateZ(-60px) translateX(20%); opacity:0 }
}

/* set duration to 1.6s for cinematic ~2s experience */
.door-opening .leaf.left{ animation: open-left 1.6s cubic-bezier(.2,.9,.2,1) forwards; }
.door-opening .leaf.right{ animation: open-right 1.6s cubic-bezier(.2,.9,.2,1) forwards; }

/* remove overlay after finished */
.hidden-overlay{ display:none !important; }

/* replay button */
.replay {
  position:fixed; right:18px; bottom:18px; z-index:10010;
  background:rgba(255,255,255,0.04); color:var(--soft); border:1px solid rgba(255,255,255,0.03);
  padding:8px 10px;border-radius:999px;font-size:13px;cursor:pointer;
}

@media (max-width:480px){
  .leaf::after{left:12%;right:12%}
  :root{ --tab-min-width:92px; }
}

/* accessibility focus */
.tab:focus { outline: 3px solid rgba(247,214,255,0.12); outline-offset:3px; }
button:focus { outline: 3px solid rgba(247,214,255,0.12); outline-offset:3px; }

</style>
</head>
<body>
  <!-- door overlay -->
  <div class="door-overlay" id="doorOverlay" aria-hidden="true">
    <div class="door-wrap" id="doorWrap">
      <div class="leaf left"><div class="label">— S15 —</div></div>
      <div class="leaf right"><div class="label">— atelier —</div></div>
    </div>
  </div>

  <!-- main content -->
  <div class="shell" id="shell">
    <div class="card" id="card">
      <div class="title-row">
        <div>
          <div class="pill">MINI APP · PROFILE</div>
          <h1>Isaline’s profile room</h1>
          <p class="subtitle">Tap a tab, then send your selection back to the bot.</p>
        </div>
      </div>

      <!-- tabs: note class 'tabs' used by JS to toggle scroll mode -->
      <div class="tabs" id="tabs">
        <button class="tab active" id="tab-zhou">✦ Zhou Xinyu</button>
        <button class="tab" id="tab-rp">✧ RP Muse</button>
      </div>

      <div class="profile" id="profile">
        <h2 id="profile-title">Zhou Xinyu</h2>
        <small id="profile-tag">Muse · TripleS</small>
        <p id="profile-text">Soft-spoken, stage-light kind of pretty.
Carries winter glow and slow-day calm,
like a quiet verse written in silver.</p>
      </div>

<div class="btn-row">
  <button class="primary" id="favBtn" aria-pressed="false" title="Add to favorites">♡ Favorite</button>
  <button class="ghost" id="playBtn" aria-pressed="false" title="Play preview">▶ Play</button>
</div>

<!-- profile audio (preview) -->
<audio id="profileAudio" preload="auto">
  <source src="profile_song.mp3" type="audio/mpeg">
</audio>

      <div class="helper">Your choice will be sent back to the bot as a tiny note.</div>
    </div>
  </div>

  <!-- optional audio: door_open.mp3 (place in same folder if you want sound) -->
  <audio id="doorAudio" preload="auto">
    <source src="door_open.mp3" type="audio/mpeg">
  </audio>

  <button class="replay" id="replayBtn" title="Replay door effect">Replay ✨</button>

<script>
  // Telegram WebApp
  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  if (tg) try { tg.expand(); tg.ready(); } catch(e){}

  const doorOverlay = document.getElementById('doorOverlay');
  const doorWrap = document.getElementById('doorWrap');
  const shell = document.getElementById('shell');
  const card = document.getElementById('card');
  const doorAudio = document.getElementById('doorAudio');
  const replayBtn = document.getElementById('replayBtn');

  // profile data
  const profiles = {
    zhou: {
      title: "Zhou Xinyu",
      tag: "Muse · TripleS",
      text: "Soft-spoken, stage-light kind of pretty.\nCarries winter glow and slow-day calm,\nlike a quiet verse written in silver."
    },
    rp: {
      title: "Lyra Nocturne",
      tag: "RP muse · night-coded",
      text: "Writes in lowercase and starlight.\nHalf diary, half song, always a little\nlate to leave the dream."
    }
  };
  let selected = 'zhou';

  // tabs

  // tabs
  const tZ = document.getElementById('tab-zhou');
  const tR = document.getElementById('tab-rp');
  const tabsRoot = document.getElementById('tabs');

  function setActive(k){
    selected = k;
    const d = profiles[k];
    document.getElementById('profile-title').textContent = d.title;
    document.getElementById('profile-tag').textContent = d.tag;
    document.getElementById('profile-text').textContent = d.text;
    if(k==='zhou'){ tZ.classList.add('active'); tR.classList.remove('active'); } else { tR.classList.add('active'); tZ.classList.remove('active'); }
  }

  // SPARKLE: create single sparkle at (x,y) relative to profile box
  function makeSparkle(x, y, size = null) {
    const profileBox = document.getElementById("profile");
    if (!profileBox) return;
    const sp = document.createElement("div");
    sp.className = "sparkle-pop";
    // randomize size a bit
    const s = size || (6 + Math.floor(Math.random()*8)); // 6-13px
    sp.style.width = s + "px";
    sp.style.height = s + "px";

    // position inside profile (x,y are offsets within profile)
    sp.style.left = Math.round(x) + "px";
    sp.style.top = Math.round(y) + "px";

    // slight rotation or transform variation
    sp.style.transform = `translateY(0) scale(${0.6 + Math.random()*0.9})`;

    profileBox.appendChild(sp);

    // remove after animation ends
    setTimeout(() => {
      if (sp && sp.parentNode) sp.parentNode.removeChild(sp);
    }, 1400);
  }

  // burst 4-7 sparkles randomly inside profile
  function burstSparkles(count = 5) {
    const box = document.getElementById("profile");
    if (!box) return;
    const rect = box.getBoundingClientRect();
    // create sparkles with small delays for natural look
    for (let i = 0; i < count; i++) {
      const delay = Math.random() * 180; // stagger
      setTimeout(() => {
        const paddingX = Math.max(8, rect.width * 0.06);
        const paddingY = Math.max(8, rect.height * 0.06);
        const x = Math.random() * (rect.width - paddingX*2) + paddingX;
        const y = Math.random() * (rect.height - paddingY*2) + paddingY;
        makeSparkle(x, y);
      }, delay);
    }
  }

  // attach sparkle to tab clicks & send button
  tZ.addEventListener('click', ()=> {
    setActive('zhou');
    burstSparkles(6);
  });
  tR.addEventListener('click', ()=> {
    setActive('rp');
    burstSparkles(6);
  });

  // make tabs accessible via keyboard arrows
  document.addEventListener('keydown', function(e){
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const active = tabs.find(t => t.classList.contains('active'));
    if(!active) return;
    const idx = tabs.indexOf(active);
    if(e.key === 'ArrowRight' && idx < tabs.length - 1) { tabs[idx+1].click(); tabs[idx+1].focus(); }
    if(e.key === 'ArrowLeft' && idx > 0) { tabs[idx-1].click(); tabs[idx-1].focus(); }
  });

  // send selection to bot (also sparkle)
  /* ---------- Favorite & Play (replacing Send & Close) ---------- */
const favBtn = document.getElementById('favBtn');
const playBtn = document.getElementById('playBtn');
const profileAudio = document.getElementById('profileAudio') || null;

// map per-profile audio filenames (ubah nama file sesuai koleksimu)
const PROFILE_AUDIO_MAP = {
  zhou: 'zhou_song.mp3',
  rp: 'rp_song.mp3'
};

function currentProfileAudioFile() {
  return PROFILE_AUDIO_MAP[selected] || 'profile_song.mp3';
}

/* FAVORITE logic (localStorage) */
const STORAGE_KEY = 'miniapp_favs_v1';
function loadFavs() {
  try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : {}; }
  catch(e){ return {}; }
}
function saveFavs(obj) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); } catch(e){}
}
function setFavState(isFav) {
  favBtn.setAttribute('aria-pressed', isFav ? 'true' : 'false');
  favBtn.textContent = isFav ? '♥ Favorited' : '♡ Favorite';
  if (isFav) {
    favBtn.classList.add('fav-active');
    // sparkle feedback
    try { burstSparkles(5); } catch(e){}
    setTimeout(()=> favBtn.classList.remove('fav-active'), 600);
  }
}
function updateFavUI() {
  const favs = loadFavs();
  setFavState(!!favs[selected]);
}

favBtn.addEventListener('click', () => {
  const favs = loadFavs();
  const currently = !!favs[selected];
  if (currently) delete favs[selected];
  else favs[selected] = { ts: Date.now() };
  saveFavs(favs);
  setFavState(!currently);
});

/* PLAY audio logic */
playBtn.addEventListener('click', async () => {
  if (!profileAudio) {
    alert('Audio not available. Tambahkan profile_song.mp3 atau file per-profile di folder.');
    return;
  }

  // set source dynamically if needed
  const desired = currentProfileAudioFile();
  const currentSource = profileAudio.querySelector('source')?.getAttribute('src') || '';
  if (currentSource !== desired) {
    profileAudio.innerHTML = `<source src="${desired}" type="audio/mpeg">`;
    try { profileAudio.load(); } catch(e){}
  }

  // toggle play/pause
  try {
    if (profileAudio.paused) {
      await profileAudio.play();
      playBtn.textContent = '⏸ Pause';
      playBtn.setAttribute('aria-pressed','true');
    } else {
      profileAudio.pause();
      playBtn.textContent = '▶ Play';
      playBtn.setAttribute('aria-pressed','false');
    }
  } catch (e) {
    playBtn.textContent = '▶ Play';
    alert('Tap to play (autoplay may be blocked).');
  }
});

if (profileAudio) {
  profileAudio.addEventListener('pause', ()=> {
    playBtn.textContent = '▶ Play';
    playBtn.setAttribute('aria-pressed','false');
    playBtn.classList.remove('playing');
  });

  profileAudio.addEventListener('ended', ()=> {
    playBtn.textContent = '▶ Play';
    playBtn.setAttribute('aria-pressed','false');
    playBtn.classList.remove('playing');
  });

  profileAudio.addEventListener('play', ()=> {
    playBtn.textContent = '⏸ Pause';
    playBtn.setAttribute('aria-pressed','true');
    playBtn.classList.add('playing');
  });
}

/* Ensure favorite UI updates on profile switch */
const oldSetActive = setActive;
setActive = function(k){
  oldSetActive(k);
  // stop audio on profile change
  try { if (profileAudio) { profileAudio.pause(); profileAudio.currentTime = 0; } } catch(e){}
};
// init fav on load
updateFavUI();

  // door sequence timings adjusted to ~2s cinematic:
  // content fades in at 1.2s, door animation duration is 1.6s, overlay removed at 1.6s
  function openDoor(playSound=true){
    // start content fade slightly before door fully finished
    setTimeout(()=> shell.classList.add('content-visible'), 1200);

    if(playSound && doorAudio && doorAudio.src){
      doorAudio.currentTime = 0;
      doorAudio.play().catch(()=>{ /* ignore autoplay restrictions */ });
    }

    doorWrap.classList.add('door-opening');

    setTimeout(()=> {
      doorOverlay.classList.add('hidden-overlay');
      shell.classList.add('content-visible');
    }, 1600);
  }

  // auto run when page loaded (give Telegram a tick)
  window.addEventListener('load', ()=> {
    setTimeout(()=> openDoor(true), 260);
  });

  // replay support
  replayBtn.addEventListener('click', ()=> {
    doorOverlay.classList.remove('hidden-overlay');
    doorWrap.classList.remove('door-opening');
    shell.classList.remove('content-visible');
    void doorWrap.offsetWidth;
    setTimeout(()=> openDoor(true), 80);
  });

  // RESPONSIVE tabs helper (auto toggles scroll mode for small screens)
  (function(){
    function updateTabsMode() {
      if(!tabsRoot) return;
      if(window.matchMedia('(max-width: 639px)').matches) {
        tabsRoot.classList.add('tabs-scroll');
      } else {
        tabsRoot.classList.remove('tabs-scroll');
      }
    }
    updateTabsMode();
    window.addEventListener('resize', updateTabsMode);
    window.addEventListener('orientationchange', updateTabsMode);
  })();

</script>
</body>
</html>
