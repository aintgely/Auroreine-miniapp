<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Profiles ‚Äî Auroreine</title>
<style>
/* Minimal CSS (sudah diringkas, tapi kamu bisa pakai CSS asli jika mau lebih rapi) */
:root { --text:#f5f3ff; --soft:#b8b5d0; --card-bg:rgba(255,255,255,0.02); }
*{box-sizing:border-box}
body{margin:0;padding:20px;min-height:100vh;background:radial-gradient(1200px 800px at 10% 10%, #1c1530 0%, #07060a 45%, #03020a 100%);color:var(--text);font-family:system-ui,Segoe UI,Roboto}
.shell{max-width:480px;margin:0 auto}
.card{background:linear-gradient(180deg,var(--card-bg),rgba(255,255,255,0.01));padding:18px;border-radius:18px;border:1px solid rgba(255,255,255,0.03)}
.tabs{display:flex;gap:8px;margin-bottom:10px}
.tab{flex:1;padding:8px 10px;border-radius:999px;background:transparent;color:var(--soft);border:1px solid transparent;cursor:pointer;text-align:center}
.tab.active{background:linear-gradient(180deg, rgba(247,214,255,0.06), rgba(247,214,255,0.03));border-color:rgba(247,214,255,0.12);color:var(--text)}
.profile{padding:12px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(9,9,18,0.95));margin-bottom:14px}
.btn-row{display:flex;gap:8px}
button{cursor:pointer}
.news-modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,4,8,0.6);z-index:1000;padding:20px}
.news-modal-backdrop.open{display:flex}
.news-modal{width:min(720px,calc(100% - 40px));max-height:80vh;overflow:auto;background:linear-gradient(180deg, rgba(12,10,14,0.96), rgba(16,14,20,0.98));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.04)}
.news-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:10px}
.grid-thumb{width:100%;height:82px;object-fit:cover;border-radius:8px;background:#111}
.news-empty{padding:26px 10px;color:var(--soft);text-align:center}
.replay{position:fixed;right:18px;bottom:18px;background:rgba(255,255,255,0.04);color:var(--soft);border-radius:999px;padding:8px 10px;border:1px solid rgba(255,255,255,0.03)}
.small-link{background:transparent;color:var(--soft);border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;text-decoration:none}
</style>
</head>
<body>
  <div class="shell">
    <div class="card" id="card">

      <!-- Header -->
      <div class="title-row simple-one">
        <h1 class="simple-name">Auroreine</h1>
      </div>

      <!-- Tabs -->
      <div class="tabs" id="tabs">
        <button class="tab active" id="tab-zhou">‚ú¶ Muse</button>
        <button class="tab" id="tab-rp">‚úß Another Universe</button>
        <button id="tab-news" class="tab" title="Latest news">üóûÔ∏è</button>
      </div>

      <!-- Profile -->
      <div class="profile" id="profile">
        <h2 id="profile-title">Zhou Xinyu</h2>
        <small id="profile-tag">Muse ¬∑ TripleS</small>
        <p id="profile-text">Soft-spoken, stage-light kind of pretty.</p>
      </div>

      <!-- Buttons -->
      <div class="btn-row">
        <button class="primary" id="favBtn" aria-pressed="false" title="Favorite">
          <img id="favIcon" alt="fox icon" src="assets/foxfixfix.gif" width="18" height="18" aria-hidden="true">
          <span class="label-text">Favorite</span>
        </button>
        <button class="ghost" id="playBtn" aria-pressed="false" title="Play preview">‚ñ∂ Play</button>
      </div>

    </div>
  </div>

  <button class="replay" id="replayBtn" title="Replay door effect">Replay ‚ú®</button>

  <!-- NEWS modal -->
  <div class="news-modal-backdrop" id="newsBackdrop" aria-hidden="true">
    <div class="news-modal" role="dialog" aria-modal="true" aria-labelledby="newsTitle">
      <div class="news-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div>
          <div id="newsTitle" style="font-weight:800;font-size:16px;">Recently update of Meredith Melrose.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button class="news-close" id="newsClose">Close</button>
          <a class="news-open-tele small-link" id="newsOpenChannel" target="_blank" rel="noopener noreferrer" href="https://t.me/S15XINYU">Open in Telegram</a>
        </div>
      </div>
      <div id="newsContent">
        <div class="news-empty" id="newsLoading">Loading latest posts‚Ä¶</div>
      </div>
    </div>
  </div>

<script>
/* ==============
   Basic elements
   ============== */
const tNews = document.getElementById('tab-news');
const newsBackdrop = document.getElementById('newsBackdrop');
const newsContent = document.getElementById('newsContent');
const newsClose = document.getElementById('newsClose');
const newsOpenChannel = document.getElementById('newsOpenChannel');

/* Utility: sparkle (kept minimal) */
function burstSparkles(count=5){ /* no-op lightweight */ }

/* =========================
   Rendering helpers (thumbnails/list)
   ========================= */
function truncateText(s, n = 140) {
  if (!s) return '';
  s = s.replace(/\s+/g,' ').trim();
  if (s.length <= n) return s;
  return s.slice(0, n-1).trim() + '‚Ä¶';
}

function renderFallbackThumbnails(posts){
  newsContent.innerHTML = '';
  const grid = document.createElement('div');
  grid.className = 'news-grid';
  if(!posts || posts.length === 0){
    newsContent.innerHTML = '<div class="news-empty">Unable to fetch previews. Try "Open in Telegram".</div>';
    const openBtn = document.createElement('a'); openBtn.className='news-open-tele small-link'; openBtn.textContent='Open channel in Telegram';
    openBtn.href = 'https://t.me/S15XINYU'; openBtn.target='_blank'; openBtn.rel='noopener noreferrer';
    newsContent.appendChild(openBtn);
    return;
  }
  posts.forEach(p => {
    const item = document.createElement('div'); item.className='grid-item';
    const a = document.createElement('a'); a.href = p.link || ('https://t.me/S15XINYU'); a.target='_blank'; a.rel='noopener noreferrer';
    const img = document.createElement('img'); img.className='grid-thumb'; img.alt = p.timeStr || 'post';
    if (p.thumb) img.src = p.thumb; else img.src = ''; // if no thumb still create element
    a.appendChild(img);
    const title = document.createElement('div'); title.style.fontSize='12px'; title.style.marginTop='6px'; title.style.color='var(--soft)';
    title.textContent = truncateText(p.excerpt || p.timeStr || '', 80);
    item.appendChild(a); item.appendChild(title); grid.appendChild(item);
  });
  newsContent.appendChild(grid);
}

function renderNewsList(posts){
  if(!posts || posts.length === 0){ newsContent.innerHTML = '<div class="news-empty">No recent posts were found.</div>'; return; }
  const list = document.createElement('div'); list.className = 'news-list';
  posts.forEach(post => {
    const item = document.createElement('div'); item.className = 'news-item'; item.style.display='flex'; item.style.gap='10px'; item.style.alignItems='flex-start'; item.style.padding='10px';
    const thumb = document.createElement('img'); thumb.className='news-thumb'; thumb.style.width='74px'; thumb.style.height='74px'; thumb.style.borderRadius='8px';
    thumb.alt = 'thumb'; thumb.loading='lazy';
    if (post.thumb) thumb.src = post.thumb; else thumb.style.background='#111';
    const meta = document.createElement('div'); meta.style.flex='1';
    const title = document.createElement('div'); title.textContent = post.timeStr || 'Post'; title.style.fontWeight='700';
    const excerpt = document.createElement('p'); excerpt.textContent = truncateText(post.excerpt || post.text || '', 140); excerpt.style.margin='6px 0 0 0'; excerpt.style.color='var(--soft)';
    const actions = document.createElement('div'); actions.style.marginTop='8px';
    const btnOpen = document.createElement('a'); btnOpen.className='news-open-tele small-link'; btnOpen.textContent='Open in Telegram'; btnOpen.href = post.link || ('https://t.me/S15XINYU'); btnOpen.target='_blank'; btnOpen.rel='noopener noreferrer';
    actions.appendChild(btnOpen);
    meta.appendChild(title); meta.appendChild(excerpt); meta.appendChild(actions);
    item.appendChild(thumb); item.appendChild(meta); list.appendChild(item);
  });
  newsContent.innerHTML = ''; newsContent.appendChild(list);
}

/* Fallback iframe (kept as ultimate fallback; but usually blocked) */
function renderFallbackIframe(){ newsContent.innerHTML=''; const iframe=document.createElement('iframe'); iframe.className='news-fallback-iframe'; iframe.src='https://t.me/s/S15XINYU'; iframe.style.width='100%'; iframe.style.height='60vh'; iframe.style.border='none'; newsContent.appendChild(iframe); }

/* =========================
   Bot-based News loader (new)
   ========================= */
async function loadNewsFromBot() {
  newsContent.innerHTML = '<div class="news-empty">Loading latest posts‚Ä¶</div>';
  try {
    const apiUrl = window.location.origin + '/api/bot-tme';
    const r = await fetch(apiUrl);
    if (!r.ok) throw new Error('API error ' + r.status);
    const payload = await r.json();
    if (payload && payload.ok && Array.isArray(payload.posts) && payload.posts.length > 0) {
      // convert posts to shape expected by renderFallbackThumbnails
      const posts = payload.posts.map(p => ({ excerpt: p.text, thumb: (p.thumbs && p.thumbs[0]) || null, link: p.link, timeStr: p.date }));
      const haveThumbs = posts.some(p => p.thumb);
      if (haveThumbs) renderFallbackThumbnails(posts);
      else renderNewsList(posts);
      return;
    } else {
      newsContent.innerHTML = '<div class="news-empty">No recent posts found by bot. Post an image & wait a moment.</div>';
    }
  } catch (err) {
    console.warn('Error fetching bot posts', err);
    newsContent.innerHTML = '<div class="news-empty">Failed to load posts ‚Äî coba lagi nanti.</div>';
  }
}

/* =========================
   Modal open/close + event handlers
   ========================= */
function openNewsModal() {
  newsBackdrop.classList.add('open'); newsBackdrop.setAttribute('aria-hidden','false');
}
function closeNewsModal() {
  newsBackdrop.classList.remove('open'); newsBackdrop.setAttribute('aria-hidden','true');
  const iframe = newsContent.querySelector('iframe'); if (iframe) iframe.src = 'about:blank';
}

tNews.addEventListener('click', ()=> {
  openNewsModal();
  loadNewsFromBot();          // <-- memanggil bot endpoint
  burstSparkles(6);
  tNews.classList.add('active');
});
newsClose.addEventListener('click', closeNewsModal);
newsBackdrop.addEventListener('click', (ev)=> { if (ev.target === newsBackdrop) closeNewsModal(); });
document.addEventListener('keydown', (e)=> { if (e.key === 'Escape' && newsBackdrop.classList.contains('open')) closeNewsModal(); });

/* =========================
   init UI (noop minimal)
   ========================= */
window.addEventListener('load', ()=>{ /* nothing else needed */ });

</script>
</body>
</html>
